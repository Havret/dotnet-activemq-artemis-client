<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.ff31de0ff">
<link rel="alternate" type="application/rss+xml" href="/dotnet-activemq-artemis-client/blog/rss.xml" title=".NET Client for ActiveMQ Artemis Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/dotnet-activemq-artemis-client/blog/atom.xml" title=".NET Client for ActiveMQ Artemis Blog Atom Feed">
<link rel="search" type="application/opensearchdescription+xml" title=".NET Client for ActiveMQ Artemis" href="/dotnet-activemq-artemis-client/opensearch.xml"><title data-react-helmet="true">Automatic Recovery From Network Failures | .NET Client for ActiveMQ Artemis</title><meta data-react-helmet="true" property="og:url" content="https://havret.github.io/dotnet-activemq-artemis-client/dotnet-activemq-artemis-client/docs/auto-recovery"><meta data-react-helmet="true" name="docsearch:language" content="en"><meta data-react-helmet="true" name="docsearch:version" content="current"><meta data-react-helmet="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Automatic Recovery From Network Failures | .NET Client for ActiveMQ Artemis"><meta data-react-helmet="true" name="description" content="A network connection between clients and ActiveMQ Artemis nodes can fail. The client library supports the automatic recovery of connections, producers, and consumers. Automatic recovery is enabled by default."><meta data-react-helmet="true" property="og:description" content="A network connection between clients and ActiveMQ Artemis nodes can fail. The client library supports the automatic recovery of connections, producers, and consumers. Automatic recovery is enabled by default."><link data-react-helmet="true" rel="shortcut icon" href="/dotnet-activemq-artemis-client/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://havret.github.io/dotnet-activemq-artemis-client/dotnet-activemq-artemis-client/docs/auto-recovery"><link data-react-helmet="true" rel="alternate" href="https://havret.github.io/dotnet-activemq-artemis-client/dotnet-activemq-artemis-client/docs/auto-recovery" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://havret.github.io/dotnet-activemq-artemis-client/dotnet-activemq-artemis-client/docs/auto-recovery" hreflang="x-default"><link data-react-helmet="true" rel="preconnect" href="https://BH4D9OD16A-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/dotnet-activemq-artemis-client/assets/css/styles.5ef53f4b.css">
<link rel="preload" href="/dotnet-activemq-artemis-client/assets/js/runtime~main.28d9907b.js" as="script">
<link rel="preload" href="/dotnet-activemq-artemis-client/assets/js/main.4c3bdaac.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#main" class="skipToContent_OuoZ">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle" type="button" tabindex="0"><svg aria-label="Menu" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/dotnet-activemq-artemis-client/"><img src="/dotnet-activemq-artemis-client/img/logo.svg" alt="My Site Logo" class="themedImage_TMUO themedImage--light_4Vu1 navbar__logo"><img src="/dotnet-activemq-artemis-client/img/logo.svg" alt="My Site Logo" class="themedImage_TMUO themedImage--dark_uzRr navbar__logo"><strong class="navbar__title">.NET Client for ActiveMQ Artemis</strong></a></div><div class="navbar__items navbar__items--right"><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/dotnet-activemq-artemis-client/docs/getting-started">Docs</a><a href="https://github.com/Havret/dotnet-activemq-artemis-client" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a><a href="https://www.nuget.org/packages/ArtemisNetClient" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Download</a><div class="react-toggle displayOnlyInLargeViewport_cxYs react-toggle--disabled" role="button" tabindex="-1"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_iYfV">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_iYfV">ðŸŒž</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/dotnet-activemq-artemis-client/"><img src="/dotnet-activemq-artemis-client/img/logo.svg" alt="My Site Logo" class="themedImage_TMUO themedImage--light_4Vu1 navbar__logo"><img src="/dotnet-activemq-artemis-client/img/logo.svg" alt="My Site Logo" class="themedImage_TMUO themedImage--dark_uzRr navbar__logo"><strong class="navbar__title">.NET Client for ActiveMQ Artemis</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link navbar__link--active" href="/dotnet-activemq-artemis-client/docs/getting-started">Docs</a></li><li class="menu__list-item"><a href="https://github.com/Havret/dotnet-activemq-artemis-client" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li><li class="menu__list-item"><a href="https://www.nuget.org/packages/ArtemisNetClient" target="_blank" rel="noopener noreferrer" class="menu__link">Download</a></li></ul></div></div></div></nav><div class="main-wrapper docs-wrapper doc-page"><div class="docPage_lDyR"><div class="docSidebarContainer_0YBq" role="complementary"><div class="sidebar_a3j0"><div class="menu menu--responsive thin-scrollbar menu_cyFh"><button aria-label="Open menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_iZzd" width="24" height="24" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Introduction</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/dotnet-activemq-artemis-client/docs/getting-started">Getting Started</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">Features</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/dotnet-activemq-artemis-client/docs/message-payload">Message payload</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/dotnet-activemq-artemis-client/docs/message-durability">Message Durability</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/dotnet-activemq-artemis-client/docs/message-priority">Message Priority</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/dotnet-activemq-artemis-client/docs/consumer-credit">Consumer credit</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/dotnet-activemq-artemis-client/docs/auto-recovery">Automatic Recovery</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Community</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/dotnet-activemq-artemis-client/docs/online-resources">Online resources</a></li></ul></li></ul></div></div></div><main class="docMainContainer_r8cw"><div class="container padding-vert--lg docItemWrapper_NJLN"><div class="row"><div class="col docItemCol_zHA2"><div class="docItemContainer_oiyr"><article><header><h1 class="docTitle_-X99">Automatic Recovery From Network Failures</h1></header><div class="markdown"><p>A network connection between clients and ActiveMQ Artemis nodes can fail. The client library supports the automatic recovery of connections, producers, and consumers. Automatic recovery is enabled by default.</p><p>Automatic recovery is controlled by <code>IRecoveryPolicy</code> interface:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI csharp"><div tabindex="0" class="prism-code language-csharp codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">public interface IRecoveryPolicy</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">{</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    int RetryCount { get; }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    TimeSpan GetDelay(int attempt);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>This interface defines how long the delay should last between subsequent recovery attempts if recovery fails due to an exception (e.g. ActiveMQ Artemis node is still not reachable), and how many recovery attempts will be made before terminal exception will be signaled.</p><p>You can subscribe to this occurrence using <code>IConnection.ConnectionRecoveryError</code> event:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI csharp"><div tabindex="0" class="prism-code language-csharp codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">var connectionFactory = new ConnectionFactory();</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">var connection = await connectionFactory.CreateAsync(endpoint);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">connection.ConnectionRecoveryError += (sender, eventArgs) =&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">{</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    // react accordingly</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">};</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>When the client library successfully reestablishes the connection, <code>IConnection.ConnectionRecovered</code> event is triggered instead.</p><p>To retry indefinite amount of times <code>RetryCount</code> should return <code>int.MaxValue</code>.</p><div class="admonition admonition-tip alert alert--success"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="16" viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</h5></div><div class="admonition-content"><p>If the initial connection to an ActiveMQ Artemis node fails, automatic connection recovery will kick in as well. It may be problematic in some scenarios, as <code>ConnectionFactory.CreateAsync</code> won&#x27;t signal any issues until the recovery policy gives up. If your recovery policy is configured to try to recover forever it may even never happen. That means you would be asynchronously waiting for the result of <code>CreateAsync</code> forever. To address this issue you can pass <code>CancellationToken</code> to <code>CreateAsync</code>. This allows you to arbitrarily break the operation at any point.</p></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="recovery-policies"></a>Recovery Policies<a class="hash-link" href="#recovery-policies" title="Direct link to heading">#</a></h2><p>There are 4 built-in recovery policies that are available via <code>RecoveryPolicyFactory</code> class:</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="decorrelated-jitter-backoff-recovery-policy"></a>Decorrelated Jitter Backoff Recovery Policy<a class="hash-link" href="#decorrelated-jitter-backoff-recovery-policy" title="Direct link to heading">#</a></h3><p>// TODO: </p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="constant-backoff-recovery-policy"></a>Constant Backoff Recovery Policy<a class="hash-link" href="#constant-backoff-recovery-policy" title="Direct link to heading">#</a></h3><p>This policy instructs the connection recovery mechanism to wait a constant amount of time between recovery attempts.</p><p>The following defines a policy that will retry 5 times and wait 1s between each recovery attempt.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI csharp"><div tabindex="0" class="prism-code language-csharp codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">var constantBackoff = RecoveryPolicyFactory.ConstantBackoff(</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    delay: TimeSpan.FromSeconds(1),</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    retryCount: 5);</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="linear-backoff-recovery-policy"></a>Linear Backoff Recovery Policy<a class="hash-link" href="#linear-backoff-recovery-policy" title="Direct link to heading">#</a></h3><p>This policy instructs the connection recovery mechanism to wait increasingly longer times between recovery attempts.</p><p>The following defines a policy with a linear retry delay of 100, 200, 300, 400, 500ms.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI csharp"><div tabindex="0" class="prism-code language-csharp codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">var linearBackoff = RecoveryPolicyFactory.LinearBackoff(</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    initialDelay: TimeSpan.FromMilliseconds(100),</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    retryCount: 5);</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>The default linear factor is 1.0. However, it can be changed:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI csharp"><div tabindex="0" class="prism-code language-csharp codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">var linearBackoff = RecoveryPolicyFactory.LinearBackoff(</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    initialDelay: TimeSpan.FromMilliseconds(100),</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    retryCount: 5,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    factor: 2);</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>This will create an increasing retry delay of 100, 300, 500, 700, 900ms.</p><p>Note, the linear factor must be greater than or equal to zero. A factor of zero will return equivalent retry delays to the <code>ConstantBackoffRecoveryPolicy</code>.</p><p>When the infinite number of retires is used, it may be useful to specify a maximum delay:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI csharp"><div tabindex="0" class="prism-code language-csharp codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">var linearBackoff = RecoveryPolicyFactory.LinearBackoff(</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    initialDelay: TimeSpan.FromMilliseconds(100),</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    maxDelay: TimeSpan.FromSeconds(15));</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="exponential-backoff-recovery-policy"></a>Exponential Backoff Recovery Policy<a class="hash-link" href="#exponential-backoff-recovery-policy" title="Direct link to heading">#</a></h3><p>This policy instructs the connection recovery mechanism to use the exponential function to calculate subsequent delays between recovery attempts. The delay duration is specified as <code>initialDelay x 2^attempt</code>. Because of the exponential nature (potential for rapidly increasing delay times), it is recommended to use this policy with a low starting delay, and explicitly setting maximum delay.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI csharp"><div tabindex="0" class="prism-code language-csharp codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">var exponentialBackoff = RecoveryPolicyFactory.ExponentialBackoff(</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    initialDelay: TimeSpan.FromMilliseconds(100),</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    retryCount: 5);</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>This will create an exponentially increasing retry delay of 100, 200, 400, 800, 1600ms.</p><p>The default exponential growth factor is 2.0. However, you can provide our own.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI csharp"><div tabindex="0" class="prism-code language-csharp codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">var exponentialBackoff = RecoveryPolicyFactory.ExponentialBackoff(</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    initialDelay: TimeSpan.FromMilliseconds(100),</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    retryCount: 5,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    factor: 4.0);</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>The upper for this retry with a growth factor of four is 25,600ms.</p><p>Note, the growth factor must be greater than or equal to one. A factor of one will return equivalent retry delays to the <code>ConstantBackoffRecoveryPolicy</code>.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="recover-from-first-failure-fast"></a>Recover from first failure fast<a class="hash-link" href="#recover-from-first-failure-fast" title="Direct link to heading">#</a></h2><p>All build-in recovery policies include an option to recover after the first failure immediately. You can enable this by passing in <code>fastFirst: true</code> to any of the policy factory methods.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI csharp"><div tabindex="0" class="prism-code language-csharp codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">var recoveryPolicy = RecoveryPolicyFactory.ExponentialBackoff(</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    initialDelay: TimeSpan.FromMilliseconds(100),</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    retryCount: 5,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    factor: 4.0,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    fastFirst: true);</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>Note, the first recovery attempt will happen immediately and it will count against your retry count. That is, this will still try to recover five times but the first recovery attempt will happen immediately after connection to the broker is lost.</p><p>The logic behind a fast first recovery strategy is that failure may just have been a transient blip rather than reflecting a deeper underlying issue that for instance results in a broker failover.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="disabling-automatic-recovery"></a>Disabling Automatic Recovery<a class="hash-link" href="#disabling-automatic-recovery" title="Direct link to heading">#</a></h2><p>To disable automatic recovery, set <code>ConnectionFactory.AutomaticRecoveryEnabled</code> to false:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI csharp"><div tabindex="0" class="prism-code language-csharp codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">var connectionFactory = new ConnectionFactory();</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">connectionFactory.AutomaticRecoveryEnabled = false;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">// connection that will not recover automatically</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">var connection = await connectionFactory.CreateAsync(endpoint);</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="failover"></a>Failover<a class="hash-link" href="#failover" title="Direct link to heading">#</a></h2><p>To provide high availability your typical ActiveMQ Artemis cluster configuration should contain at least 2 nodes: a master and a slave. For most of the time, only the master node is operational and it handles all of the requests. When the master goes down, however, failover occurs and the slave node becomes active.</p><p>To handle this scenario with the client library you need to use <code>ConnectionFactory.CreateAsync</code> overload that accepts <code>IEnumerable&lt;Endpoint&gt;</code>. This way when the connection to the first node is lost, the auto-recovery mechanism will try to reconnect to the second node. The endpoints are selected in a round-robin fashion using the original sequence with which the connection was created.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI csharp"><div tabindex="0" class="prism-code language-csharp codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">var masterEndpoint = Endpoint.Create(</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    host: &quot;master&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    port: 5672,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    user: &quot;guest&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    password: &quot;guest&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    scheme: Scheme.Amqp);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">var slaveEndpoint = Endpoint.Create(</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    host: &quot;slave&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    port: 5672,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    user: &quot;guest&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    password: &quot;guest&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    scheme: Scheme.Amqp);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">var connectionFactory = new ConnectionFactory();</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">var connection = await connectionFactory.CreateAsync(new[]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">{</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    masterEndpoint,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    slaveEndpoint</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">});</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/Havret/dotnet-activemq-artemis-client/edit/master/website/../docs/auto-recovery.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" role="img" viewBox="0 0 40 40" class="iconEdit_mS5F" aria-label="Edit page"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/dotnet-activemq-artemis-client/docs/consumer-credit"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« Consumer credit</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/dotnet-activemq-artemis-client/docs/online-resources"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Online resources Â»</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_vrFS thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#recovery-policies" class="table-of-contents__link">Recovery Policies</a><ul><li><a href="#decorrelated-jitter-backoff-recovery-policy" class="table-of-contents__link">Decorrelated Jitter Backoff Recovery Policy</a></li><li><a href="#constant-backoff-recovery-policy" class="table-of-contents__link">Constant Backoff Recovery Policy</a></li><li><a href="#linear-backoff-recovery-policy" class="table-of-contents__link">Linear Backoff Recovery Policy</a></li><li><a href="#exponential-backoff-recovery-policy" class="table-of-contents__link">Exponential Backoff Recovery Policy</a></li></ul></li><li><a href="#recover-from-first-failure-fast" class="table-of-contents__link">Recover from first failure fast</a></li><li><a href="#disabling-automatic-recovery" class="table-of-contents__link">Disabling Automatic Recovery</a></li><li><a href="#failover" class="table-of-contents__link">Failover</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/dotnet-activemq-artemis-client/docs/getting-started">Get Started</a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items"><li class="footer__item"><a href="https://github.com/Havret/dotnet-activemq-artemis-client" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2021 Havret. Built with Docusaurus.</div></div></div></footer></div>
<script src="/dotnet-activemq-artemis-client/assets/js/runtime~main.28d9907b.js"></script>
<script src="/dotnet-activemq-artemis-client/assets/js/main.4c3bdaac.js"></script>
</body>
</html>