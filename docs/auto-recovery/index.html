<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.6">
<link rel="search" type="application/opensearchdescription+xml" title=".NET Client for ActiveMQ Artemis" href="/dotnet-activemq-artemis-client/opensearch.xml"><title data-react-helmet="true">Automatic Recovery From Network Failures | .NET Client for ActiveMQ Artemis</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://havret.github.io/dotnet-activemq-artemis-client/dotnet-activemq-artemis-client/docs/auto-recovery"><meta data-react-helmet="true" name="docsearch:language" content="en"><meta data-react-helmet="true" name="docsearch:version" content="current"><meta data-react-helmet="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Automatic Recovery From Network Failures | .NET Client for ActiveMQ Artemis"><meta data-react-helmet="true" name="description" content="A network connection between clients and ActiveMQ Artemis nodes can fail. The client library supports the automatic recovery of connections, producers, and consumers. Automatic recovery is enabled by default."><meta data-react-helmet="true" property="og:description" content="A network connection between clients and ActiveMQ Artemis nodes can fail. The client library supports the automatic recovery of connections, producers, and consumers. Automatic recovery is enabled by default."><link data-react-helmet="true" rel="shortcut icon" href="/dotnet-activemq-artemis-client/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://havret.github.io/dotnet-activemq-artemis-client/dotnet-activemq-artemis-client/docs/auto-recovery"><link data-react-helmet="true" rel="alternate" href="https://havret.github.io/dotnet-activemq-artemis-client/dotnet-activemq-artemis-client/docs/auto-recovery" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://havret.github.io/dotnet-activemq-artemis-client/dotnet-activemq-artemis-client/docs/auto-recovery" hreflang="x-default"><link data-react-helmet="true" rel="preconnect" href="https://BH4D9OD16A-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/dotnet-activemq-artemis-client/assets/css/styles.1dc838a3.css">
<link rel="preload" href="/dotnet-activemq-artemis-client/assets/js/runtime~main.ba107d72.js" as="script">
<link rel="preload" href="/dotnet-activemq-artemis-client/assets/js/main.d40878aa.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><div class="announcementBar_3WsW" role="banner"><div class="announcementBarPlaceholder_2m9F"></div><div class="announcementBarContent_3EUC">‚≠êÔ∏è If you like .NET Client for ActiveMQ Artemis, give it a star on <a target="_blank" rel="noopener noreferrer" href="https://github.com/Havret/dotnet-activemq-artemis-client">GitHub</a>! ‚≠êÔ∏è</div><button type="button" class="clean-btn close announcementBarClose_38nx" aria-label="Close"><svg viewBox="0 0 24 24" width="14" height="14" fill="currentColor"><path d="M24 20.188l-8.315-8.209 8.2-8.282-3.697-3.697-8.212 8.318-8.31-8.203-3.666 3.666 8.321 8.24-8.206 8.313 3.666 3.666 8.237-8.318 8.285 8.203z"></path></svg></button></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/dotnet-activemq-artemis-client/"><img src="/dotnet-activemq-artemis-client/img/logo.svg" alt="My Site Logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/dotnet-activemq-artemis-client/img/logo.svg" alt="My Site Logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><b class="navbar__title">.NET Client for ActiveMQ Artemis</b></a></div><div class="navbar__items navbar__items--right"><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/dotnet-activemq-artemis-client/docs/getting-started">Docs</a><a href="https://github.com/Havret/dotnet-activemq-artemis-client" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a><a href="https://www.nuget.org/packages/ArtemisNetClient" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Download</a><div class="react-toggle toggle_3Zt9 react-toggle--disabled"><div class="react-toggle-track" role="button" tabindex="-1"><div class="react-toggle-track-check"><span class="toggle_71bT">üåú</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">üåû</span></div><div class="react-toggle-thumb"></div></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div><div class="searchBox_1Doo"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_31aa"><button class="clean-btn backToTopButton_35hR" type="button"><svg viewBox="0 0 24 24" width="28"><path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z" fill="currentColor"></path></svg></button><aside class="docSidebarContainer_3Kbt"><div class="sidebar_15mo"><nav class="menu thin-scrollbar menu_Bmed menuWithAnnouncementBar_2WvA"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Introduction</a></li><li class="theme-doc-sidebar-item-category menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#">Features</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/dotnet-activemq-artemis-client/docs/message-payload">Message payload</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/dotnet-activemq-artemis-client/docs/message-durability">Message Durability</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/dotnet-activemq-artemis-client/docs/message-priority">Message Priority</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/dotnet-activemq-artemis-client/docs/consumer-credit">Consumer credit</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/dotnet-activemq-artemis-client/docs/auto-recovery">Automatic Recovery</a></li></ul></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Community</a></li></ul></nav></div></aside><main class="docMainContainer_3ufF"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><div class="tocCollapsible_1PrD theme-doc-toc-mobile tocMobile_3Hoh"><button type="button" class="clean-btn tocCollapsibleButton_2O1e">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Automatic Recovery From Network Failures</h1></header><p>A network connection between clients and ActiveMQ Artemis nodes can fail. The client library supports the automatic recovery of connections, producers, and consumers. Automatic recovery is enabled by default.</p><p>Automatic recovery is controlled by <code>IRecoveryPolicy</code> interface:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly csharp"><pre tabindex="0" class="prism-code language-csharp codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">public interface IRecoveryPolicy</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">{</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    int RetryCount { get; }</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    TimeSpan GetDelay(int attempt);</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>This interface defines how long the delay should last between subsequent recovery attempts if recovery fails due to an exception (e.g. ActiveMQ Artemis node is still not reachable), and how many recovery attempts will be made before terminal exception will be signaled.</p><p>You can subscribe to this occurrence using <code>IConnection.ConnectionRecoveryError</code> event:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly csharp"><pre tabindex="0" class="prism-code language-csharp codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">var connectionFactory = new ConnectionFactory();</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">var connection = await connectionFactory.CreateAsync(endpoint);</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">connection.ConnectionRecoveryError += (sender, eventArgs) =&gt;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">{</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    // react accordingly</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">};</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>When the client library successfully reestablishes the connection, <code>IConnection.ConnectionRecovered</code> event is triggered instead.</p><p>To retry indefinite amount of times <code>RetryCount</code> should return <code>int.MaxValue</code>.</p><div class="admonition admonition-tip alert alert--success"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="16" viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</h5></div><div class="admonition-content"><p>If the initial connection to an ActiveMQ Artemis node fails, automatic connection recovery will kick in as well. It may be problematic in some scenarios, as <code>ConnectionFactory.CreateAsync</code> won&#x27;t signal any issues until the recovery policy gives up. If your recovery policy is configured to try to recover forever it may even never happen. That means you would be asynchronously waiting for the result of <code>CreateAsync</code> forever. To address this issue you can pass <code>CancellationToken</code> to <code>CreateAsync</code>. This allows you to arbitrarily break the operation at any point.</p></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="recovery-policies"></a>Recovery Policies<a class="hash-link" href="#recovery-policies" title="Direct link to heading">#</a></h2><p>There are 4 built-in recovery policies that are available via <code>RecoveryPolicyFactory</code> class:</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="decorrelated-jitter-backoff-recovery-policy"></a>Decorrelated Jitter Backoff Recovery Policy<a class="hash-link" href="#decorrelated-jitter-backoff-recovery-policy" title="Direct link to heading">#</a></h3><p>// TODO: </p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="constant-backoff-recovery-policy"></a>Constant Backoff Recovery Policy<a class="hash-link" href="#constant-backoff-recovery-policy" title="Direct link to heading">#</a></h3><p>This policy instructs the connection recovery mechanism to wait a constant amount of time between recovery attempts.</p><p>The following defines a policy that will retry 5 times and wait 1s between each recovery attempt.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly csharp"><pre tabindex="0" class="prism-code language-csharp codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">var constantBackoff = RecoveryPolicyFactory.ConstantBackoff(</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    delay: TimeSpan.FromSeconds(1),</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    retryCount: 5);</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="linear-backoff-recovery-policy"></a>Linear Backoff Recovery Policy<a class="hash-link" href="#linear-backoff-recovery-policy" title="Direct link to heading">#</a></h3><p>This policy instructs the connection recovery mechanism to wait increasingly longer times between recovery attempts.</p><p>The following defines a policy with a linear retry delay of 100, 200, 300, 400, 500ms.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly csharp"><pre tabindex="0" class="prism-code language-csharp codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">var linearBackoff = RecoveryPolicyFactory.LinearBackoff(</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    initialDelay: TimeSpan.FromMilliseconds(100),</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    retryCount: 5);</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>The default linear factor is 1.0. However, it can be changed:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly csharp"><pre tabindex="0" class="prism-code language-csharp codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">var linearBackoff = RecoveryPolicyFactory.LinearBackoff(</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    initialDelay: TimeSpan.FromMilliseconds(100),</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    retryCount: 5,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    factor: 2);</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>This will create an increasing retry delay of 100, 300, 500, 700, 900ms.</p><p>Note, the linear factor must be greater than or equal to zero. A factor of zero will return equivalent retry delays to the <code>ConstantBackoffRecoveryPolicy</code>.</p><p>When the infinite number of retires is used, it may be useful to specify a maximum delay:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly csharp"><pre tabindex="0" class="prism-code language-csharp codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">var linearBackoff = RecoveryPolicyFactory.LinearBackoff(</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    initialDelay: TimeSpan.FromMilliseconds(100),</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    maxDelay: TimeSpan.FromSeconds(15));</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="exponential-backoff-recovery-policy"></a>Exponential Backoff Recovery Policy<a class="hash-link" href="#exponential-backoff-recovery-policy" title="Direct link to heading">#</a></h3><p>This policy instructs the connection recovery mechanism to use the exponential function to calculate subsequent delays between recovery attempts. The delay duration is specified as <code>initialDelay x 2^attempt</code>. Because of the exponential nature (potential for rapidly increasing delay times), it is recommended to use this policy with a low starting delay, and explicitly setting maximum delay.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly csharp"><pre tabindex="0" class="prism-code language-csharp codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">var exponentialBackoff = RecoveryPolicyFactory.ExponentialBackoff(</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    initialDelay: TimeSpan.FromMilliseconds(100),</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    retryCount: 5);</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>This will create an exponentially increasing retry delay of 100, 200, 400, 800, 1600ms.</p><p>The default exponential growth factor is 2.0. However, you can provide our own.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly csharp"><pre tabindex="0" class="prism-code language-csharp codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">var exponentialBackoff = RecoveryPolicyFactory.ExponentialBackoff(</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    initialDelay: TimeSpan.FromMilliseconds(100),</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    retryCount: 5,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    factor: 4.0);</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>The upper for this retry with a growth factor of four is 25,600ms.</p><p>Note, the growth factor must be greater than or equal to one. A factor of one will return equivalent retry delays to the <code>ConstantBackoffRecoveryPolicy</code>.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="recover-from-first-failure-fast"></a>Recover from first failure fast<a class="hash-link" href="#recover-from-first-failure-fast" title="Direct link to heading">#</a></h2><p>All build-in recovery policies include an option to recover after the first failure immediately. You can enable this by passing in <code>fastFirst: true</code> to any of the policy factory methods.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly csharp"><pre tabindex="0" class="prism-code language-csharp codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">var recoveryPolicy = RecoveryPolicyFactory.ExponentialBackoff(</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    initialDelay: TimeSpan.FromMilliseconds(100),</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    retryCount: 5,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    factor: 4.0,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    fastFirst: true);</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Note, the first recovery attempt will happen immediately and it will count against your retry count. That is, this will still try to recover five times but the first recovery attempt will happen immediately after connection to the broker is lost.</p><p>The logic behind a fast first recovery strategy is that failure may just have been a transient blip rather than reflecting a deeper underlying issue that for instance results in a broker failover.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="disabling-automatic-recovery"></a>Disabling Automatic Recovery<a class="hash-link" href="#disabling-automatic-recovery" title="Direct link to heading">#</a></h2><p>To disable automatic recovery, set <code>ConnectionFactory.AutomaticRecoveryEnabled</code> to false:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly csharp"><pre tabindex="0" class="prism-code language-csharp codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">var connectionFactory = new ConnectionFactory();</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">connectionFactory.AutomaticRecoveryEnabled = false;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">// connection that will not recover automatically</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">var connection = await connectionFactory.CreateAsync(endpoint);</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="failover"></a>Failover<a class="hash-link" href="#failover" title="Direct link to heading">#</a></h2><p>To provide high availability your typical ActiveMQ Artemis cluster configuration should contain at least 2 nodes: a master and a slave. For most of the time, only the master node is operational and it handles all of the requests. When the master goes down, however, failover occurs and the slave node becomes active.</p><p>To handle this scenario with the client library you need to use <code>ConnectionFactory.CreateAsync</code> overload that accepts <code>IEnumerable&lt;Endpoint&gt;</code>. This way when the connection to the first node is lost, the auto-recovery mechanism will try to reconnect to the second node. The endpoints are selected in a round-robin fashion using the original sequence with which the connection was created.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly csharp"><pre tabindex="0" class="prism-code language-csharp codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">var masterEndpoint = Endpoint.Create(</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    host: &quot;master&quot;,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    port: 5672,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    user: &quot;guest&quot;,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    password: &quot;guest&quot;,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    scheme: Scheme.Amqp);</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">var slaveEndpoint = Endpoint.Create(</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    host: &quot;slave&quot;,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    port: 5672,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    user: &quot;guest&quot;,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    password: &quot;guest&quot;,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    scheme: Scheme.Amqp);</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">var connectionFactory = new ConnectionFactory();</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">var connection = await connectionFactory.CreateAsync(new[]</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">{</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    masterEndpoint,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    slaveEndpoint</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">});</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/Havret/dotnet-activemq-artemis-client/edit/master/website/../docs/auto-recovery.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_13-_"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/dotnet-activemq-artemis-client/docs/consumer-credit"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">¬´ Consumer credit</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/dotnet-activemq-artemis-client/docs/online-resources"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Online resources ¬ª</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#recovery-policies" class="table-of-contents__link">Recovery Policies</a><ul><li><a href="#decorrelated-jitter-backoff-recovery-policy" class="table-of-contents__link">Decorrelated Jitter Backoff Recovery Policy</a></li><li><a href="#constant-backoff-recovery-policy" class="table-of-contents__link">Constant Backoff Recovery Policy</a></li><li><a href="#linear-backoff-recovery-policy" class="table-of-contents__link">Linear Backoff Recovery Policy</a></li><li><a href="#exponential-backoff-recovery-policy" class="table-of-contents__link">Exponential Backoff Recovery Policy</a></li></ul></li><li><a href="#recover-from-first-failure-fast" class="table-of-contents__link">Recover from first failure fast</a></li><li><a href="#disabling-automatic-recovery" class="table-of-contents__link">Disabling Automatic Recovery</a></li><li><a href="#failover" class="table-of-contents__link">Failover</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/dotnet-activemq-artemis-client/docs/getting-started">Get Started</a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items"><li class="footer__item"><a href="https://github.com/Havret/dotnet-activemq-artemis-client" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright ¬© 2021 Havret. Built with Docusaurus.</div></div></div></footer></div>
<script src="/dotnet-activemq-artemis-client/assets/js/runtime~main.ba107d72.js"></script>
<script src="/dotnet-activemq-artemis-client/assets/js/main.d40878aa.js"></script>
</body>
</html>